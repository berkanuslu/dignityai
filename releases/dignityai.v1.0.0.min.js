var DignityAIBase=function(){DignityObject.call(this);this.bullets=this.parentObject=null;this.life=100;this.level=this.value=0;this.speed=1;this.missionList=[];this.missionIndex=0;this.friendList=[];this.enemyList=[];this.obstacleList=[];this.collectableList=[];this.ignoreList=[];this.pathList=[];this.pathIndex=0;this.moveEnd=this.moveStart=!1;this.senseRadius=1;this.senseEnd=this.senseStart=!1;this.collectedObjects=[]};DignityAIBase.prototype=Object.create(DignityObject.prototype);
DignityAIBase.prototype.constructor=DignityAIBase;DignityAIBase.prototype.start=function(){for(var a=0;a<this.missionList.length;a++)this.missionList[a].async&&this.missionList[a].execute();this.missionList[this.missionIndex].async||this.missionList[this.missionIndex].execute()};DignityAIBase.prototype.executeMission=function(){this.missionList[this.missionIndex].execute()};
DignityAIBase.prototype.nextMission=function(){0<this.missionList.length&&this.missionIndex<this.missionList.length?this.missionIndex++:this.missionIndex=0};DignityAIBase.prototype.prevMission=function(){0<this.missionList.length&&0<this.missionIndex?this.missionIndex--:this.missionIndex=0};DignityAIBase.prototype.nextPath=function(){0<this.pathList.length&&this.pathIndex<this.pathList.length?this.pathIndex++:this.pathIndex=0};
DignityAIBase.prototype.prevPath=function(){0<this.pathList.length&&0<this.pathIndex?this.pathIndex--:this.pathIndex=0};
DignityAIBase.prototype.move=function(a){if(this.moveStart&&!this.moveEnd&&0<this.pathList.length&&this.pathIndex<this.pathList.length){var b=this.pathList[this.pathIndex],c=b.movementPath.length;if(0<c&&b.movementPathCurrent<c){var c=.5+1*b.movementPath[b.movementPathCurrent][1],g=47.5-1*b.movementPath[b.movementPathCurrent][0];a.movePoint=new pc.Vec3(c,0,g);var e=a.entity.getPosition(),f=new pc.Vec3;f.lerp(e,a.movePoint,.025);a.entity.setPosition(f);e.x.toFixed(1)>c.toFixed(1)-1&&e.z.toFixed(1)>
g.toFixed(1)-1&&(b.movementPathCurrent++,console.log("current movePath: "+b.movementPathCurrent));b.movementPathCurrent===b.movementPath.length&&(this.nextPath(),this.moveEnd=!0,this.moveStart=!1,a=this.missionList[this.missionIndex],null!=a.actionEnd&&(a.end=!0,a.executeEndAction(),this.nextMission()))}}};
DignityAIBase.prototype.sense=function(a,b){if(this.senseStart&&!this.senseEnd){var c=a.entity.getPosition();c.x=Math.floor(c.x);c.z=Math.floor(c.z);c.y=0;var g=c.clone(),e=c.clone(),f=c.clone(),p=c.clone(),c=c.clone(),t=6*this.senseRadius,q=2*this.senseRadius,l=1*this.senseRadius;g.z+=t;e.z+=t;f.z+=t;p.z+=t;c.z+=t;e.x+=q;f.x-=q;p.x+=l;c.x-=l;this.cast(b,a,g.x,g.y,g.z);this.cast(b,a,e.x,e.y,e.z);this.cast(b,a,f.x,f.y,f.z);this.cast(b,a,p.x,p.y,p.z);this.cast(b,a,c.x,c.y,c.z)}};
DignityAIBase.prototype.cast=function(a,b,c,g,e){if(this.senseStart&&!this.senseEnd){var f=new pc.Vec3;c=new pc.Vec3(c,g,e);f.copy(b.entity.getPosition());f.y=0;a.systems.rigidbody.raycastFirst(f,c,this.findHit.bind(this))}};
DignityAIBase.prototype.findHit=function(a){if(this.senseStart&&!this.senseEnd){var b=a.entity.getName().split("_")[0],c=!0;0>this.ignoreList.indexOf(b)&&(0<=this.friendList.indexOf(b)&&(console.log("detected friend: "+b),this.detectedFriend(a.entity),c=!1),0<=this.enemyList.indexOf(b)&&(console.log("detected enemy: "+b),this.detectedEnemy(a.entity),c=!1),0<=this.collectableList.indexOf(b)&&(console.log("detected collectable: "+b),this.detectedCollectable(a.entity),c=!1),0<=this.obstacleList.indexOf(b)&&
(console.log("detected obstacle: "+b),this.detectedObstacle(a.entity),c=!1),c&&(console.log("detected object: "+b),this.detectedOther(a.entity)))}};DignityAIBase.prototype.stopSense=function(){this.senseEnd=!0;this.senseStart=!1;var a=this.missionList[this.missionIndex];null!=a.actionEnd&&(a.end=!0,a.executeEndAction(),this.nextMission())};DignityAIBase.prototype.detectedFriend=function(a){console.log("detectedFriend action base")};DignityAIBase.prototype.detectedEnemy=function(a){console.log("detectedEnemy action base")};
DignityAIBase.prototype.detectedCollectable=function(a){console.log("detectedCollectable action base")};DignityAIBase.prototype.detectedObstacle=function(a){console.log("detectedObstacle action base")};DignityAIBase.prototype.detectedOther=function(a){console.log("detectedOther action base")};DignityAIBase.prototype.shoot=function(a,b){console.log("shoot action base");a["new"]({id:(new Date).getTime(),from:this.parentObject,tx:b.getPosition().x,ty:b.getPosition().z,sp:1})};var DignityAction=function(){DignityObject.call(this);this.createObjPos=this.createObj=null;this.destroyObj=new DignityAIBase;this.destroyLevel=0;this.upgradeObj=null;this.upgradeObjPropName="";this.upgradeObjNewVal=this.upgradeObjIncVal=0;this.moveObj=new DignityAIBase;this.moveFollowObj=null;this.senseObj=new DignityAIBase;this.senseTriggerTime=this.senseRadius=0;this.customActionObj=null;this.customActionName="";this.maxTurnAngle=this.fireSpeed=this.ammo=0};DignityAction.prototype=Object.create(DignityObject.prototype);
DignityAction.prototype.constructor=DignityAction;DignityAction.prototype.create=function(){this.createObj.clone();this.createObj.setPosition(this.createObjPos)};DignityAction.prototype.destroy=function(){this.destroyObj.life-=this.destroyLevel};
DignityAction.prototype.upgrade=function(){this.upgradeObj.hasOwnProperty(this.upgradeObjPropName)&&(0<this.upgradeObjIncVal?this.upgradeObj[this.upgradeObjPropName]+=this.upgradeObjIncVal:0<this.upgradeObjNewVal&&(this.upgradeObj[this.upgradeObjPropName]=this.upgradeObjNewVal))};DignityAction.prototype.move=function(){null!=this.moveObj&&(this.moveObj.moveStart=!0,this.moveObj.moveEnd=!1)};
DignityAction.prototype.sense=function(){null!=this.senseObj&&(this.senseObj.senseRadius=this.senseRadius,this.senseObj.senseStart=!0,this.senseObj.senseEnd=!1)};DignityAction.prototype.custom=function(){this.customActionObj[this.customActionName]()};var DignityAnimal=function(){DignityAIBase.call(this);this.type="";this.isLiveCrowd=this.isHuntSameType=this.isHuntHuman=!1};DignityAnimal.prototype=Object.create(DignityAIBase.prototype);DignityAnimal.prototype.constructor=DignityAnimal;DignityAnimal.prototype.detectedFriend=function(a){console.log("human detectedFriend action");this.isHuntHuman&&0<=a.getName().indexOf("human")&&this.huntHuman(a);this.isHuntSameType&&0<=a.getName().indexOf("animal")&&this.huntAnimal(a)};
DignityAnimal.prototype.detectedEnemy=function(a){console.log("human detectedEnemy action");this.bullets=this.appContext.root.getChildren()[0].script.bullets;this.shoot(this.bullets,a)};DignityAnimal.prototype.huntHuman=function(a){console.log("human hunting");this.bullets=this.appContext.root.getChildren()[0].script.bullets;this.shoot(this.bullets,a)};
DignityAnimal.prototype.huntAnimal=function(a){console.log("animal hunting");this.bullets=this.appContext.root.getChildren()[0].script.bullets;this.shoot(this.bullets,a)};var DignityHuman=function(){DignityAIBase.call(this);this.senseEnemySpeed=0;this.isFindCover=!1;this.fearEnemyLevel=0};DignityHuman.prototype=Object.create(DignityAIBase.prototype);DignityHuman.prototype.constructor=DignityHuman;DignityHuman.prototype.detectedFriend=function(a){console.log("human detectedFriend action")};
DignityHuman.prototype.detectedEnemy=function(a){console.log("human detectedEnemy action");this.bullets=this.appContext.root.getChildren()[0].script.bullets;this.shoot(this.bullets,a)};DignityHuman.prototype.detectedOther=function(a){console.log("detectedOther action base");var b=result.entity.getName();this.isFindCover&&0<=b.indexOf("cover")&&this.coverObject(a)};DignityHuman.prototype.coverObject=function(a){console.log("human cover object");this.speed=0};var DignityMission=function(){DignityObject.call(this);this.desc="";this.actionStart=new DignityAction;this.actionStartName="";this.actionEnd=new DignityAction;this.actionEndName="";this.actionTime=new DignityAction;this.actionTimeName="";this.time=this.finishTime=0;this.end=this.async=this.continuous=!1};DignityMission.prototype=Object.create(DignityObject.prototype);DignityMission.prototype.constructor=DignityMission;DignityMission.prototype.executeAction=function(a,b){a[b]()};
DignityMission.prototype.executeEndAction=function(){if(""!==this.actionEndName)this.actionEnd[this.actionEndName]()};
DignityMission.prototype.execute=function(){0<this.finishTime?(this.executeAction(this.actionStart,this.actionStartName),window.setTimeout(this.executeAction,this.finishTime,this.actionEnd,this.actionEndName)):0>=this.time&&(this.end?this.executeAction(this.actionEnd,this.actionEndName):this.executeAction(this.actionStart,this.actionStartName));0<this.time&&(this.continuous?window.setInterval(this.executeAction,this.time,this.actionTime,this.actionTimeName):window.setTimeout(this.executeAction,this.time,
this.actionTime,this.actionTimeName))};var DignityObject=function(){this.appContext=null;this.layer=this.tag=this.name="";this.isEnable=!0};var DignityPath=function(){DignityObject.call(this);this.from=[];this.subPaths=[];this.to=[];this.randomable=this.isPong=!1;this.randomRange=0;this.map=[[]];this.movementPath=[];this.movementPathCurrent=0};DignityPath.prototype=Object.create(DignityObject.prototype);DignityPath.prototype.constructor=DignityPath;
DignityPath.prototype.findPath=function(){function a(a,b){return null!=c[a]&&null!=c[a][b]&&0>=c[a][b]}function b(a,b){return{Parent:a,value:b.x+b.y*g,x:b.x,y:b.y,f:0,g:0}}var c=this.map,g=c[0].length,e=c.length,f=g*e,p=this.from,t=this.to;if(this.randomable){for(var q=Math.floor(Math.random()*(g-2-this.randomRange)+1),l=Math.floor(Math.random()*(e-2-this.randomRange)+1),x=this.map[q][l];1===x;)q=Math.floor(Math.random()*(g-2)+1),l=Math.floor(Math.random()*(e-2)+1),x=this.map[q][l];t=[q,l]}var C=
Math.abs,E=Math.max,D=function(a,b){return E(C(a.x-b.x),C(a.y-b.y))};this.movementPath=function(){for(var c=b(null,{x:p[0],y:p[1]}),q=b(null,{x:t[0],y:t[1]}),l=Array(f),c=[c],y=[],z=[],k,m,d,h,r;m=c.length;){k=f;d=-1;for(h=0;h<m;h++)c[h].f<k&&(k=c[h].f,d=h);m=c.splice(d,1)[0];if(m.value===q.value){d=y[y.push(m)-1];do z.push([d.x,d.y]);while(d=d.Parent);l=y=c=[];z.reverse()}else{var u=m.x,n=m.y,v=n-1,w=n+1;r=u+1;d=u-1;h=-1<v&&a(u,v);var x=w<e&&a(u,w),A=r<g&&a(r,n),B=-1<d&&a(d,n);k=[];h&&k.push({x:u,
y:v});A&&k.push({x:r,y:n});x&&k.push({x:u,y:w});B&&k.push({x:d,y:n});u=x;n=k;h&&(A&&a(r,v)&&n.push({x:r,y:v}),B&&a(d,v)&&n.push({x:d,y:v}));u&&(A&&a(r,w)&&n.push({x:r,y:w}),B&&a(d,w)&&n.push({x:d,y:w}));h=0;for(r=k.length;h<r;h++)d=b(m,k[h]),l[d.value]||(d.g=m.g+D(k[h],m),d.f=d.g+D(k[h],q),c.push(d),l[d.value]=!0);y.push(m)}}return z}();this.movementPathCurrent=0};var DignityStructure=function(){DignityAIBase.call(this);this.destroyable=!0;this.storeCapacity=0;this.storeObjects=[];this.outputObject=null;this.outputObjects=[];this.outputTime=0};DignityStructure.prototype=Object.create(DignityAIBase.prototype);DignityStructure.prototype.constructor=DignityStructure;DignityStructure.prototype.destroy=function(){this.destroyable&&(this.storeCapacity=0,this.storeObjects=[],this.outputObjects=[],this.outputTime=0)};
DignityStructure.prototype.store=function(a){0<this.storeCapacity&&this.storeCapacity<this.storeObjects.length&&this.storeObjects.push(a)};DignityStructure.prototype.generate=function(a){0<this.outputTime?window.setTimeout(this.pushOutput,this.outputTime,a):this.pushOutput(a)};DignityStructure.prototype.pushOutput=function(a){this.outputObjects.push(this.outputObject);a&&this.store(this.outputObject)};var DignityVehicle=function(){DignityAIBase.call(this);this.engineLife=100;this.driveSpeed=1;this.onRoad=this.onRail=this.onSea=this.onAir=!1;this.updateSpeed()};DignityVehicle.prototype=Object.create(DignityAIBase.prototype);DignityVehicle.prototype.constructor=DignityVehicle;DignityVehicle.prototype.updateSpeed=function(){this.speed=this.engineLife/100*this.driveSpeed};DignityVehicle.prototype.crashVehicle=function(a){0<a&&(this.engineLife-=a,this.updateSpeed());0>=this.engineLife&&this.stopEngine()};
DignityVehicle.prototype.stopEngine=function(){this.speed=0};DignityVehicle.prototype.repairEngine=function(a){0<a&&(this.engineLife+=a,this.updateSpeed())};DignityVehicle.prototype.detectedFriend=function(a){console.log("vehicle detectedFriend action")};DignityVehicle.prototype.detectedEnemy=function(a){console.log("vehicle detectedEnemy action");this.bullets=this.appContext.root.getChildren()[0].script.bullets;this.shoot(this.bullets,a)};